{% extends "base.html" %}
{% block title %}Weekly View ‚Äî Meeting Prep Agent{% endblock %}
{% block head %}
<style>
  .week-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; margin-top: 1rem; }
  @media (max-width: 900px) { .week-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 500px) { .week-grid { grid-template-columns: 1fr; } }
  .day-col { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 0.75rem; min-height: 180px; box-shadow: var(--shadow); }
  .day-col.today { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-light); }
  .day-header { font-weight: 700; font-size: 0.9rem; margin-bottom: 0.5rem; padding-bottom: 0.4rem; border-bottom: 1px solid var(--border); color: var(--muted); }
  .day-header.today-hdr { color: var(--accent); }
  .evt { border-left: 3px solid var(--accent); border-radius: 6px; padding: 0.4rem 0.6rem; margin-bottom: 0.4rem; font-size: 0.8rem; background: var(--bg); }
  .evt .evt-title { font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text); }
  .evt .evt-time { color: var(--muted); font-size: 0.72rem; }
  .evt .evt-meta { color: var(--muted); font-size: 0.7rem; }
  .evt[data-source="google"] { border-left-color: var(--google); }
  .evt[data-source="outlook"], .evt[data-source="ical"] { border-left-color: var(--outlook); }
  .evt[data-source="unitime"] { border-left-color: var(--unitime); }
  .evt[data-source="manual"] { border-left-color: var(--manual); }
  .no-events { color: var(--muted); font-size: 0.8rem; font-style: italic; padding: 0.5rem 0; }
  .legend { display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem; font-size: 0.78rem; color: var(--muted); }
  .legend span { display: flex; align-items: center; gap: 0.3rem; }
  .legend span::before { content: ""; width: 10px; height: 10px; border-radius: 3px; }
  .legend .l-google::before { background: var(--google); }
  .legend .l-outlook::before { background: var(--outlook); }
  .legend .l-unitime::before { background: var(--unitime); }
  .legend .l-icloud::before { background: var(--icloud); }
  .legend .l-manual::before { background: var(--manual); }
</style>
{% endblock %}
{% block content %}
<div class="page-header">
  <h1>üìÖ Weekly View</h1>
  <p class="subtitle">All your events from every calendar, in one place.</p>
</div>

{% if errors %}
  <div class="card" style="border-left:4px solid var(--warn);">
    <h2>‚ö†Ô∏è Warnings</h2>
    <ul style="list-style:none;">
    {% for e in errors %}
      <li class="muted" style="padding:0.2rem 0;">{{ e }}</li>
    {% endfor %}
    </ul>
  </div>
{% endif %}

<div class="week-grid">
  {% for day in days %}
    <div class="day-col{% if loop.index0 == 0 %} today{% endif %}">
      <div class="day-header{% if loop.index0 == 0 %} today-hdr{% endif %}">
        {{ day.dow }} {{ day.date[5:] }}
      </div>
      {% if day.events %}
        {% for it in day.events %}
          <div class="evt" data-source="{{ it.source }}">
            <div class="evt-title" title="{{ it.title }}">{{ it.title }}</div>
            {% if it.start and it.end %}
              <div class="evt-time">{{ it.start[11:16] }} ‚Äì {{ it.end[11:16] }}</div>
            {% endif %}
            {% if it.location %}
              <div class="evt-meta">{{ it.location }}</div>
            {% endif %}
          </div>
        {% endfor %}
      {% else %}
        <div class="no-events">No events</div>
      {% endif %}
    </div>
  {% endfor %}
</div>

<div class="legend">
  <span class="l-google">Google</span>
  <span class="l-outlook">Outlook</span>
  <span class="l-unitime">UniTime</span>
  <span class="l-icloud">iCloud</span>
  <span class="l-manual">Manual</span>
</div>
{% endblock %}
